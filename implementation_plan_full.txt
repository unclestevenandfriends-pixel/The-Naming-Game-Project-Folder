Master Implementation Plan: The Last Mile (18 Items)
This plan consolidates all 18 pending tasks into a strictly sequenced, dependency-aware roadmap. Each phase builds upon the stability of the previous one.
User Review Required IMPORTANT Sequential Execution: We will tackle one item at a time. After each item, we will verify the state before moving to the next. This prevents the "Shunt Effect" where one change breaks downstream logic. WARNING Protocol Zero Compliance: All changes must respect the Shell/Slide boundary. Local slide logic must not interfere with Global Shell properties (Map, Navigation, Sound).
Phase 1: Infrastructure & Rails (The Pillars)
Goal: Fix the way the game starts, moves, and exits. Testing other slides depends on these.
02. Fullscreen Button Repair
Target: js/core.js. Action: Fix toggleFullScreen to properly use the Fullscreen API and handle cross-browser/mobile quirks. Claude Note: ⚠️ iOS Safari does not support the standard Fullscreen API on <html> or <body>. Consider adding a fallback that either (a) displays a "Not Supported" toast, or (b) uses a CSS-based "pseudo-fullscreen" that just hides the browser chrome visually. Also wrap in try-catch to prevent script errors.
[ADDITIVE CONTENT FROM LIST 2]: Fullscreen Button: Why Second: A system-level toggle that should be working to allow proper testing layout. User Transcript: "The full screen button doesn't actually have any effect. When you press it, it actually tells you to just press escape to exit full screen, but even if you do press escape, it doesn't have any effect either." Interdependent Parts: js/core.js (Event Listeners), Draft 1 The Naming Game Index.HTML (Button ID: fullscreen-btn). Safety Protocols:
	•	Mobile Safety (Source 28): Ensure the fullscreen logic handles iOS Safari quirks (which often block fullscreen API). Do not rely on hover states for the button feedback.
	•	Protocol 6 (Event Bubbles): Ensure the event listener is not attached multiple times if the core script re-initializes.
03. Hub Auto-Return Standardization
Target: js/map.js. Action: Define the "Global Rule" for hubs (e.g., standardizing the returnToMap flag). Dependency: Prevents map ejection conflicts in Evidence A/B. Claude Note: ⚠️ Decision Required: The user transcript suggests two options: (A) Always auto-return to map after hub-child completion, or (B) Never auto-return. I recommend Option B (Never Auto-Eject) with a visible "Return to Map" button, as this gives the user explicit control and prevents the "jarring" UX described in the transcript. This flag should default to false in nodeConfig.
[ADDITIVE CONTENT FROM LIST 2]: Hub auto‑return logic: Why Third: You must decide the "Standard Rule" (e.g., "Never Auto-Eject") before fixing individual games like Evidence A/B. If you fix the game logic first but the navigation rule is still "Auto-Eject," the player will still get kicked out unexpectedly. User Transcript: "Currently, all of these slides take the player straight back to the map upon completion automatically. ... We need to standardise the behaviour. So either we need to make the executive decision that for all games linked to a central hub... remove the automatic redirecting... or we do the opposite... irrespective of whether they're connected to centralised hubs or not." Interdependent Parts: js/map.js (Node Config Objects), js/games.js (Completion Triggers), js/navigation_guards.js. Safety Protocols:
	•	Protocol 3 (Bridge Integrity): Ensure that MapSystem.closeSlideDeck() is ONLY called if returnToMap: true is explicitly set in the config.
	•	Dead End Prevention (Source 27): If auto-return is disabled, you MUST ensure the "Next" arrow unlocks immediately so the user isn't trapped in the slide.
04. Backwards Navigation Branch Lock
Target: js/navigation_guards.js. Action: Implement logic to block prevSlide() specifically on hub branches (10A/B/C) if the parent hub node is incomplete. Claude Note: ✅ Claude Approved. Ensure the lock checks MapSystem.isNodeComplete(parentNodeId) rather than a volatile local variable. The children are: N10 (Central Camp) -> N10A, N10B, N10C; N28 (Detective Hub) -> N28A, N28B.
[ADDITIVE CONTENT FROM LIST 2]: Backwards Navigation Lock: Why Fourth: This enforces the rules of movement. It prevents the player from roaming into broken states. It must be active before we test the specific games. User Transcript: "Also, I've just noticed that if the player completes the game, or completes certain nodes and levels and makes progress, but then backwards navigates on the slides to an earlier position... And so I'm also considering if it makes sense that when the user reaches a central hub, their backwards roam ability is blocked until they complete all three games connected to that hub, and only at that point can they roam all the way backwards." Interdependent Parts: js/navigation_guards.js (prevSlide logic), js/slide_registry.js (Slide order). Safety Protocols:
	•	Protocol 5 (XP Farming): When blocking backward navigation, ensure we also disable GameEngine.triggerReward() for any slides re-visited during valid backward movement.
	•	State Sovereignty: The lock status must check MapSystem.isNodeComplete(), not a local variable, to ensure it survives a page refresh.
05. Exit Ticket 1 & 2 Timing Fix
Target: js/games.js, EXIT 1.HTML, EXIT 2.HTML. Action: Decouple Map Unlock from CSS animations. Trigger parent completion immediately on logic success. Claude Note: ✅ Claude Approved. Call window.parent.MapSystem.completeNode() synchronously on correct answer, before any animation. Use setTimeout only for visual feedback, not for logic.
[ADDITIVE CONTENT FROM LIST 2]: Exit 1 & Exit 2 timing: Why Fifth: This repairs the "Gates" of the game. The map unlock signal must be reliable before we trust that the player can progress naturally. User Transcript: "Timer/Scanner sync issues" Interdependent Parts: slide_exit_01.html, slide_exit_02.html, js/games.js (Timer logic). Safety Protocols:
	•	Protocol 3 (Bridge Integrity): The unlock signal to the Parent (window.parent.MapSystem.completeNode()) must happen independently of the CSS animation finishing. Do not tie critical logic to animationend events, which can fail if the tab is backgrounded.
Phase 2: Logic Engines & State (The Brain)
Goal: Fix internal mechanics of complex slides once navigation is stable.
06. Evidence A/B Completion Logic
Target: js/games.js, Evidence A.html, Evidence B.html. Action: Ensure "Complete" only triggers when 100% of targets found. Fix the "Auto-Eject" bug. Claude Note: ⚠️ The user noted "Miss" and "February" are being ignored in Evidence B. Verify the TARGETS array includes all 7 required proper nouns: ["Davies", "Oliver", "Sophie", "Friday", "February", "Miss", "Muddle"]. If "Miss" is omitted, add it. British English confirms Titles (Mr, Mrs, Miss, Dr) are Proper Nouns when used as part of a name.
[ADDITIVE CONTENT FROM LIST 2]: Evidence A/B Logic: Why Sixth: Now that "Hub Auto-Return" is standardized (Item 3), we can fix the internal scoring to ensure it triggers "Complete" only when all items are found, without fear of the map overriding it. User Transcript: "Further to the fact that they autocomplete and rush the user back to the map, actually the way the game registers completion is incorrect. It seems to clock that they've identified all the nouns in those games, even when they haven't. So if we look at evidence B, for example, I could enter or click on the words “Davies”, “Oliver”, “Sophie”, and “Friday”, and then it would register that that slide is complete. But actually, I'm still supposed to click on “February”, “Miss”, and “Muddle”, because they are also correct nouns..." Interdependent Parts: slide_evidence_a.html, slide_evidence_b.html, js/games.js (checkEvidenceCompletion). Safety Protocols:
	•	Protocol 5 (XP Farming): Ensure GameEngine.triggerReward() fires ONLY when foundTargets === totalTargets.
	•	Grammar Standardization (Source 47): Ensure "Miss" is treated as a required Proper Noun in the validation array.
07. Miss Muddle Sentence Queue
Target: js/games.js, slide_27_miss_muddle.html. Action: Fix the state machine to render the next DOM element/sentence correctly without a page refresh. Claude Note: ⚠️ The root cause is likely the initMuddle() function not incrementing its sentence index or re-calling renderMuddle() after a sentence is completed. Check if muddleSentences array index is being persisted to localStorage. If not, add localStorage.setItem('muddle_idx', currentIdx) after each sentence.
[ADDITIVE CONTENT FROM LIST 2]: Miss Muddle Queue: Why Seventh: This is a self-contained State Machine fix. It requires precise DOM manipulation to ensure the "Next" button renders content. User Transcript: "On slide 27, the case of Miss Muddle, something is broken. ... In previous builds, when they did one sentence, another one appeared. But currently, what happens is they do one sentence and then the sentence disappears, but the next one doesn't appear until the player navigates away from the slide and back to it." Interdependent Parts: slide_27_miss_muddle.html, js/games.js (State Machine / Index tracker). Safety Protocols:
	•	Protocol 2 (State Sovereignty): The current sentence index (muddle_idx) must be saved to localStorage or GameEngine state immediately. If the user accidentally refreshes, they should not restart at Sentence 1.
	•	Protocol 6 (Event Bubbles): Use .replaceWith(clone) or removeEventListener on the "Next Sentence" button to prevent multiple clicks firing if the script re-runs.
08. Case Closed 54-Item Audit & Counter
Target: Case Closed.HTML, js/rewards.js. Action: Audit all 54 IDs. Add a dynamic visual counter ("X/54 Found"). Claude Note: ⚠️ Run a DOM audit: document.querySelectorAll('[data-noun]').length inside the slide to confirm exactly 54 elements exist. If fewer, the logic will soft-lock. Add a visual counter element: <span id="case-counter">0/54</span> and update it on each correct click.
[ADDITIVE CONTENT FROM LIST 2]: Case Closed 54‑item check: Why Eighth: This is a data integrity audit. We must ensure the HTML actually contains the 54 IDs the logic is looking for, or the "Counter" we add will be wrong. User Transcript: "Interactions failing" / "Also note the behaviour here, where moving to the next node, which is case closed, works fine, but then the detective's hub parent still looks like it has pending actions to do to it..." Interdependent Parts: slide_29_case_closed.html, js/rewards.js (Target counter). Safety Protocols:
	•	Protocol 1 (Ghosting): When adding the visual counter (e.g., "4/54 Found"), ensure this element is cleared or reset if the user leaves the slide and returns, so it doesn't show old data on a new session.
09. Map Hub Completion Ticks
Target: js/map.js, css/styles.css. Action: Implement visual "Complete" ticks for Parent Hub Nodes (Central Camp, Detective Hub, Trial Hub). Claude Note: ✅ Claude Approved. Add a checkHubCompletion(hubId, childIds) helper function. If all children are complete, apply .node-complete class to the parent. CSS should include a checkmark pseudo-element (:after { content: '✓'; }).
[ADDITIVE CONTENT FROM LIST 2]: Hub Completion Ticks (Map): Why Ninth: This is the visual result of the logic above. We can only verify the Green Ticks work if Evidence A/B and Miss Muddle actually register as "Complete" correctly first. User Transcript: "Just another quick note regarding the central hub camp... upon completion of all three, or two, or any connected nodes which are required before the hub itself is registered as fully complete, we should have a tick appearing. So you see here, having completed people hunt, places hunt, and things and animals hunt, this central hub camp node should also have a tick on it. The reason this is important is because when the player has progressed beyond that point, if they look at the map, the way it's pulsating still almost looks like they're still pending things to do." Interdependent Parts: js/map.js (updateNodes, nodeConfig), css/styles.css (.node-complete class). Safety Protocols:
	•	Protocol 4 (Registry Sync): Ensure the Parent Node IDs (e.g., N10, N28) are correctly mapped to their children in map.js. If a child ID is wrong, the parent will never tick, causing a "forever pending" bug.
10. Ghost Button Logic Integration
Target: js/core.js, css/styles.css. Action: Programmatically apply .btn-disabled class to locked navigation arrows based on node.unlocked state. Claude Note: ⚠️ The CSS rule exists in styles.css. The missing piece is the JavaScript that applies the class. In updateNavigationUI() or equivalent, add: nextBtn.classList.toggle('btn-disabled', !isNextUnlocked). Ensure pointer-events: none is part of the .btn-disabled rule.
[ADDITIVE CONTENT FROM LIST 2]: Ghost button look applied: Why Tenth: This applies the visual "Disabled" state to navigation buttons. It depends on the logic (Item 3, 4, 5) correctly reporting whether a node is locked or unlocked. User Transcript: "Buttons looking active when disabled" Interdependent Parts: css/styles.css, js/core.js (Navigation UI). Safety Protocols:
	•	Mobile Safety (Source 28): Do not rely on opacity alone. Add pointer-events: none to the .btn-disabled class to physically prevent clicks on touch devices where "hover" doesn't exist.
Phase 3: Content & UI Polish (The Paint)
11. Slide 5 Reality Scan Input
Target: slide_05.html. Action: Add text entry container and integrate the voice-typer component helper. Claude Note: ⚠️ Ensure the input field is inside the iframe content, NOT on the global canvas layer (Protocol 1: Ghosting). Check if js/voice-typer.js or similar already exists; if so, reuse it. If not, the Web Speech API (SpeechRecognition) can be initialized on button click.
[ADDITIVE CONTENT FROM LIST 2]: Slide 5 Input: Why Eleventh: Adding the text/voice input is a feature addition. It uses existing libraries but is isolated to Slide 5. User Transcript: "On slide five there are two games. ... The content on the slide says node one, exit protocol, the gatekeeper. However, the first game on the left is fine, but the game on the right should really feature a kind of text entry box as well, so that the student has an opportunity to either type or to list nouns using a voice typer." Interdependent Parts: slide_05.html, js/voice-typer.js (or existing voice module). Safety Protocols:
	•	Protocol 1 (Ghosting): Ensure the text input field is part of the Iframe content, NOT the overlay canvas. If it's on the canvas, it might persist to the next slide.
12. Golden Rule Typo Fix
Target: The Golden Rule Challenge.html. Action: Add missing ? to "Where is dad". Claude Note: ✅ Claude Approved. Simple text edit. Verify layout doesn't break on smaller screens after adding the character.
[ADDITIVE CONTENT FROM LIST 2]: Golden Rule Typo: Why Twelfth: Simple text replacement. Zero risk. User Transcript: "On the Golden Rule challenge on slide 26, there is one sentence that says “where is dad” or “where is my dad”, but it should have a question mark at the end and currently doesn't." Interdependent Parts: slide_26_golden_rule.html. Safety Protocols:
	•	Content Hygiene: Ensure the added ? doesn't push the text to a new line (breaking layout) on smaller screens.
13. Quiz 30A/B/C Grammar Audit
Target: js/games.js, Quiz...html. Action: Standardize sentence caps and the "I" capitalization while preserving specific challenge errors. Claude Note: ⚠️ The user's instructions are nuanced: In 30A, intentionally leave the "I" lowercase as part of the challenge. In 30B/C, capitalize "I" correctly so it's not a distractor. Carefully audit which words are data-target vs static text. Sync any HTML text changes with the JS correctAnswers array.
[ADDITIVE CONTENT FROM LIST 2]: Quiz Capitalization: Why Thirteenth: Content hygiene. Fixes the "I" and sentence starters. Zero risk. User Transcript: "For slide 30A... I think we should capitalise the first letter of each sentence, except on item C. I think “Lucy is very good at painting.” We should leave the “I” lowercase at the start of the sentence and make that part of the challenge. Likewise, on slide 30B... we should capitalise the first letter of every sentence. We should also capitalise the “I” in the last sentence..." Interdependent Parts: slide_30a.html, slide_30b.html, slide_30c.html, js/games.js (Validation Logic). Safety Protocols:
	•	Protocol 5 (XP Farming): Changing the text content MUST be matched by updating the "Correct Answer" logic in games.js. If you fix the typo in HTML but not in the JS validator, the user will be marked wrong for the correct answer.
14. Completion Message Styling
Target: css/styles.css, js/games.js. Action: Restyle "Node Complete" alerts to look like static prestige headers rather than clickable buttons. Claude Note: ✅ Claude Approved. Remove btn, btn-primary, cursor-pointer, shadow-lg classes. Add text-xl font-bold text-brand-400 cursor-default select-none and disable any click handlers on the element.
[ADDITIVE CONTENT FROM LIST 2]: Completion Messages: Why Fourteenth: CSS/HTML adjustment to stop text looking like buttons. Safe to do once the messages are triggering correctly. User Transcript: "For example, you see here on slide nine, when I complete the noun sorting challenge, it says, “Fantastic, you sorted all the nouns correctly. Node two complete.” However, the way it's presented, it almost looks like the words “node two complete” appear on a button, and it's also flashing. It does look okay, but where it looks a bit like a button, that could cause confusion and the student may feel like they have to press it..." Interdependent Parts: css/styles.css (Feedback classes), js/games.js (Message injection). Safety Protocols:
	•	Visual Safety: Change the cursor style to cursor: default explicitly to signal non-interactivity.
15. Mega Mix Slide 11 Letterbox Fix
Target: slide_11...html, css/styles.css. Action: Remove borders and set viewport to 100% width/height. Claude Note: ✅ Claude Approved. Set padding: 0; margin: 0; width: 100%; height: 100%; on the main container. Ensure box-sizing: border-box is applied to prevent overflow.
[ADDITIVE CONTENT FROM LIST 2]: Mega Mix Visuals: Why Fifteenth: Removing letterboxing/borders. Pure CSS. User Transcript: "Okay, now I'm on Megamix boss, and we need to tweak the visual layout of this slide, because there is a kind of letterbox or black band or border on the bottom as well as the top, and there's also a kind of border on the right and left you can see here, which actually lights up when the cursor floats over it." Interdependent Parts: slide_11_mega_mix.html, css/styles.css. Safety Protocols:
	•	Protocol 1 (Visual Safety): When removing borders (padding: 0), ensure box-sizing: border-box is set so the content doesn't overflow or trigger scrollbars that break the "App-like" feel.
16. VIP List Slide 25 Cleanup
Target: slide_25...html. Action: Remove redundant/inert "Next" button and black bars. Claude Note: ⚠️ Before deleting the internal "Next" button, verify the global shell navigation arrow is functional on this slide. If it's disabled, removing the internal button creates a dead-end. Check NavigationGuard.isNextAllowed() for this slide key.
[ADDITIVE CONTENT FROM LIST 2]: VIP List UI: Why Sixteenth: Removing the dead "Next" button and borders. Pure cleanup. User Transcript: "On slide 25, the VIP list, we again have this letterbox kind of layout problem, where there's a black band at the top and bottom, and also on these borders on the right. Also, for some reason, on this slide it says “Next” at the bottom right, but it doesn't do anything, so we need to remove it." Interdependent Parts: slide_25_vip_list.html. Safety Protocols:
	•	Dead End Prevention (Source 27): Before removing the "Next" button inside the slide, verify that the Global "Next" Arrow (Shell) is active and working. If the slide button was the only way out, removing it creates a soft lock.
17. Lobby/Character Selection Visuals
Target: Draft 1 The Naming Game Index.HTML, css/styles.css. Action: Fix background darkness and re-enable hero animations. Claude Note: ⚠️ The #lobby-screen or #lobby-content may have an opaque black background covering the animated grid. Check for bg-black or bg-[#0B0C15] with 100% opacity. Reduce to bg-black/50 or use bg-transparent with backdrop-blur to let the animated particles show through.
[ADDITIVE CONTENT FROM LIST 2]: Lobby/Hero Visuals: Why Seventeenth: Fixing the dark background. Pure CSS/Animation fix. User Transcript: "Okay, first thing on the character selection screen: it's rather hard to see the slide background. It appears too dark and has the impression that it's actually just a blank background because we cannot see the background properly, because it looks too dark and the animation is not playing." Interdependent Parts: Draft 1 The Naming Game Index.HTML (Lobby container), css/styles.css. Safety Protocols:
	•	Performance (Source 21): If enabling animations, ensure they are GPU-accelerated (transform/opacity) and not using heavy JavaScript loops, to keep the framerate high on tablet devices.
Phase 4: Destructive Cleanup (The Trash)
18. Slide 8 Redundant Content Removal
Target: slide_08.html. Action: Delete legacy game content. Safety: Cross-verify js/games.js to ensure no shared logic with Slide 10C is deleted. Claude Note: ⚠️ High Risk. Before deleting, run grep -n "slide-8\|slide_08\|#slide-8" js/games.js to identify any direct ID references. If games.js uses shared selectors like .noun-hunt-grid, ensure Slide 10C uses a unique container ID. Delete HTML only; do not modify games.js unless absolutely necessary.
[ADDITIVE CONTENT FROM LIST 2]: Slide 8 Cleanup: Why Last: You explicitly noted this shares logic with Slide 10C. We should only delete Slide 8 after we have verified that Slide 10C is working perfectly (in Phase 2), so we know exactly what code to preserve. User Transcript: "On slide eight there is still an interactive game that says, “Look at the words below. Can you find and click on the nouns?” This should have been removed... Be very careful, because the truth is that that game has actually not been deleted, but it has been moved on to slide 10c... I'm being very particular and precise about this because if you're going to remove it from slide eight, as you should do, you need to make sure that it remains on slide 10c, or anything you do to remove it from slide eight does not affect anything on slide 10c later." Interdependent Parts: slide_08.html, slide_10c.html, js/games.js (Shared Game Logic). Safety Protocols:
	•	Code Dependency Check: Before deleting HTML from Slide 8, search games.js for any ID references that might be shared. If games.js targets an ID that exists on both slides, removing one might cause a null error if the script runs globally. Ensure the script checks if (element) { ... } before running.
Verification Plan
Unit Verification: Each item has a specific "Pass/Fail" check before proceeding. Regression Test: After each phase, a full map traversal (Linear and Hubbed) will be performed. Protocol Audit: Ensure no canvas "ghosts" are left during any navigation transition.
Claude's Additional Observations
TIP Sticky Notes Bug (from Transcript): The user mentioned sticky notes persisting across slides ("ghosting") and not registering to the correct slide. This is likely a MarkupCoordinator.saveCurrentSlideNotes() timing issue. Ensure this is called in NavigationGuard.beforeTransition() before clearing the canvas. Consider adding this as Item 19 if not already resolved.
TIP Session Summary Amnesia (from Transcript): Notes don't appear until page refresh. This is a localStorage read timing issue in reporting.js. Ensure generateNotesSummary() explicitly calls localStorage.getItem() rather than reading from a cached volatile object. Consider adding this as Item 20 if not already resolved.
